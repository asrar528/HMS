{% extends "base.html" %}

{% block title %}HMS – Edit {{ hospital.hospital_name }}{% endblock %}

{% block header_title %}{{ hospital.hospital_name }}{% endblock %}
{% block header_sub %}Edit Hospital Details &nbsp;|&nbsp; ID: {{ hospital.id }}{% endblock %}
{% block header_right %}
  <span class="badge hms-badge-active me-2">
    <i class="bi bi-circle-fill me-1 text-success" style="font-size:.55rem;"></i>Active
  </span>
{% endblock %}

{% block body %}
<div class="hms-page-bg py-4 px-3 px-md-5">

  <!-- Error banner -->
  {% if error %}
  <div class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endif %}

  <!-- Helper: current value – shows POST value if available, else the saved hospital field -->
  {% macro val(field, attr) %}
    {%- if form_data -%}{{ form_data.get(field, '') }}{%- else -%}{{ attr }}{%- endif -%}
  {% endmacro %}

  <form method="POST"
        action="{{ url_for('web.edit_hospital', hospital_id=hospital.id) }}"
        novalidate>

    <div class="hms-card p-4 p-md-5">

      <!-- Form title + back link -->
      <div class="d-flex align-items-start justify-content-between mb-1">
        <div>
          <h4 class="hms-form-title mb-1">Edit Hospital Details</h4>
          <p class="text-muted small mb-0">
            Fields marked with <span class="text-danger">*</span> are mandatory.
          </p>
        </div>
        <a href="{{ url_for('web.dashboard', hospital_id=hospital.id) }}"
           class="btn btn-outline-secondary btn-sm mt-1">
          <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
        </a>
      </div>

      <!-- ──────────────────────────────────────────────
           SECTION 1 – Hospital Identity
           ────────────────────────────────────────────── -->
      <div class="hms-section-label mt-4">1. &nbsp; Hospital Identity</div>
      <div class="row g-3 mt-0 mb-3">
        <div class="col-md-6">
          <label class="form-label">Hospital Name <span class="text-danger">*</span></label>
          <input type="text" name="hospital_name" class="form-control"
                 value="{{ val('hospital_name', hospital.hospital_name) }}" required />
        </div>
        <div class="col-md-6">
          <label class="form-label">Registration No. <span class="text-danger">*</span></label>
          <input type="text" name="registration_number" class="form-control"
                 value="{{ val('registration_number', hospital.registration_number) }}" required />
        </div>

        <div class="col-md-6">
          <label class="form-label">Hospital Type <span class="text-danger">*</span></label>
          <select name="hospital_type" class="form-select" required>
            <option value="">— Select —</option>
            {% set cur_type = val('hospital_type', hospital.hospital_type) %}
            {% for t in hospital_types %}
              <option value="{{ t }}" {{ 'selected' if cur_type == t }}>{{ t }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Specialization <span class="text-danger">*</span></label>
          <select name="specialization_type" class="form-select" required>
            <option value="">— Select —</option>
            {% set cur_spec = val('specialization_type', hospital.specialization_type) %}
            {% for s in specialization_types %}
              <option value="{{ s }}" {{ 'selected' if cur_spec == s }}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label">Established Year <span class="text-danger">*</span></label>
          <input type="number" name="established_year" class="form-control"
                 min="1800" max="2026"
                 value="{{ val('established_year', hospital.established_year) }}" required />
        </div>
        <div class="col-md-4">
          <label class="form-label">Accreditation</label>
          <select name="accreditation" class="form-select">
            {% set cur_accr = val('accreditation', hospital.accreditation) %}
            {% for a in accreditation_options %}
              <option value="{{ a }}" {{ 'selected' if cur_accr == a }}>{{ a }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">GSTIN</label>
          <input type="text" name="gstin" class="form-control" placeholder="Optional"
                 value="{{ val('gstin', hospital.gstin or '') }}" />
        </div>
      </div>

      <!-- ──────────────────────────────────────────────
           SECTION 2 – Address & Location
           ────────────────────────────────────────────── -->
      <div class="hms-section-label">2. &nbsp; Address &amp; Location</div>
      <div class="row g-3 mt-0 mb-3">
        <div class="col-12">
          <label class="form-label">Address Line 1 <span class="text-danger">*</span></label>
          <input type="text" name="address_line1" class="form-control"
                 value="{{ val('address_line1', hospital.address_line1) }}" required />
        </div>
        <div class="col-12">
          <label class="form-label">Address Line 2</label>
          <input type="text" name="address_line2" class="form-control" placeholder="Optional"
                 value="{{ val('address_line2', hospital.address_line2 or '') }}" />
        </div>

        <div class="col-md-4">
          <label class="form-label">City <span class="text-danger">*</span></label>
          <input type="text" name="city" class="form-control"
                 value="{{ val('city', hospital.city) }}" required />
        </div>
        <div class="col-md-4">
          <label class="form-label">State <span class="text-danger">*</span></label>
          <select name="state" class="form-select" required>
            <option value="">— Select State —</option>
            {% set cur_state = val('state', hospital.state) %}
            {% for st in india_states %}
              <option value="{{ st }}" {{ 'selected' if cur_state == st }}>{{ st }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">PIN Code <span class="text-danger">*</span></label>
          <input type="text" name="pin_code" class="form-control"
                 value="{{ val('pin_code', hospital.pin_code) }}" required />
        </div>
        <div class="col-md-2">
          <label class="form-label">Country <span class="text-danger">*</span></label>
          <input type="text" name="country" class="form-control"
                 value="{{ val('country', hospital.country) }}" required />
        </div>
      </div>

      <!-- ──────────────────────────────────────────────
           SECTION 3 – Contact Information
           ────────────────────────────────────────────── -->
      <div class="hms-section-label">3. &nbsp; Contact Information</div>
      <div class="row g-3 mt-0 mb-3">
        <div class="col-md-4">
          <label class="form-label">Primary Phone <span class="text-danger">*</span></label>
          <input type="tel" name="phone_primary" class="form-control"
                 placeholder="+91XXXXXXXXXX"
                 value="{{ val('phone_primary', hospital.phone_primary) }}" required />
        </div>
        <div class="col-md-4">
          <label class="form-label">Alternate Phone</label>
          <input type="tel" name="phone_alternate" class="form-control" placeholder="Optional"
                 value="{{ val('phone_alternate', hospital.phone_alternate or '') }}" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Emergency Contact <span class="text-danger">*</span></label>
          <input type="tel" name="emergency_contact" class="form-control"
                 placeholder="+91XXXXXXXXXX"
                 value="{{ val('emergency_contact', hospital.emergency_contact) }}" required />
        </div>

        <div class="col-md-6">
          <label class="form-label">Email Address <span class="text-danger">*</span></label>
          <input type="email" name="email" class="form-control"
                 value="{{ val('email', hospital.email) }}" required />
        </div>
        <div class="col-md-6">
          <label class="form-label">Website</label>
          <input type="url" name="website" class="form-control"
                 placeholder="https://www.hospital.com (Optional)"
                 value="{{ val('website', hospital.website or '') }}" />
        </div>
      </div>

      <!-- ──────────────────────────────────────────────
           SECTION 4 – Capacity & Infrastructure
           ────────────────────────────────────────────── -->
      <div class="hms-section-label">4. &nbsp; Capacity &amp; Infrastructure</div>
      <div class="row g-3 mt-0 mb-3">
        <div class="col-md-4">
          <label class="form-label">Total Beds <span class="text-danger">*</span></label>
          <input type="number" name="total_beds" class="form-control" min="1"
                 value="{{ val('total_beds', hospital.total_beds) }}" required />
        </div>
        <div class="col-md-4">
          <label class="form-label">ICU Beds</label>
          <input type="number" name="icu_beds" class="form-control" min="0"
                 value="{{ val('icu_beds', hospital.icu_beds) }}" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Operation Theaters</label>
          <input type="number" name="operation_theaters" class="form-control" min="0"
                 value="{{ val('operation_theaters', hospital.operation_theaters) }}" />
        </div>
      </div>

      <!-- ──────────────────────────────────────────────
           SECTION 5 – Administration & Licensing
           ────────────────────────────────────────────── -->
      <div class="hms-section-label">5. &nbsp; Administration &amp; Licensing</div>
      <div class="row g-3 mt-0 mb-4">
        <div class="col-md-6">
          <label class="form-label">Administrator / CEO Name <span class="text-danger">*</span></label>
          <input type="text" name="administrator_name" class="form-control"
                 value="{{ val('administrator_name', hospital.administrator_name) }}" required />
        </div>
        <div class="col-md-6">
          <label class="form-label">License Number <span class="text-danger">*</span></label>
          <input type="text" name="license_number" class="form-control"
                 value="{{ val('license_number', hospital.license_number) }}" required />
        </div>
      </div>

      <!-- ──────────────────────────────────────────────
           ACTION BUTTONS
           ────────────────────────────────────────────── -->
      <div class="d-flex justify-content-between align-items-center mt-2">
        <a href="{{ url_for('web.dashboard', hospital_id=hospital.id) }}"
           class="btn btn-outline-secondary px-4">
          <i class="bi bi-x-circle me-1"></i>Cancel
        </a>
        <div class="d-flex gap-3">
          <button type="reset" class="btn btn-secondary px-4">
            <i class="bi bi-arrow-counterclockwise me-1"></i>Reset
          </button>
          <button type="submit" class="btn hms-btn-save px-5">
            <i class="bi bi-floppy-fill me-1"></i>Save Changes
          </button>
        </div>
      </div>

    </div><!-- /.hms-card -->
  </form>
</div>
{% endblock %}
